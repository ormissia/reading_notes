---
doc_type: weread-highlights-reviews
bookId: "27741281"
author: 杜军
cover: https://wfqqreader-1252317822.image.myqcloud.com/cover/281/27741281/t7_27741281.jpg
reviewCount: 0
noteCount: 17
readingStatus: 在读
progress: 58%
totalReadDay: 4
readingTime: 2小时49分钟
readingDate: 2024-02-20
isbn: 9787121373398
lastReadDate: 2024-02-23

---

# Kubernetes网络权威指南：基础、原理与实践


#读书笔记 #计算机 #计算机综合

# 元数据
> [!abstract] Kubernetes网络权威指南：基础、原理与实践
> - ![ Kubernetes网络权威指南：基础、原理与实践|200](https://wfqqreader-1252317822.image.myqcloud.com/cover/281/27741281/t7_27741281.jpg)
> - 书名： Kubernetes网络权威指南：基础、原理与实践
> - 作者： 杜军
> - 简介： 本书是容器与Kubernetes网络的基础和进阶书籍，旨在让更多人了解和学习云原生时代的底层网络模型与实现机制，指导企业在落地云原生时的网络方案选型。全书包括：容器网络虚拟化基础、Docker容器网络、Kubernetes网络和Istio网络4部分，共6章。第1章容器网络虚拟化基础将支撑容器网络的内核技术娓娓道来。第2章简单介绍了Docker原生的容器网络能力。Kubernetes网络分为3章，第3章介绍Kubernetes网络的基础概念和使用，第4章为读者剖析了Kubernetes网络的底层实现原理，第5章详解了业界主流的Kubernetes网络插件。Istio网络总共1章，重点解析Istio网络流量管控的背后机制。
> - 出版时间 2019-10-01 00:00:00
> - ISBN： 9787121373398
> - 分类： 计算机-计算机综合
> - 出版社： 电子工业出版社
> - PC地址：https://weread.qq.com/web/reader/829328f071a74c6182975cc

# 高亮划线


## 第1章 夯实基础：Linux网络虚拟化

> 📌 Linux的namespace（名字空间）的作用就是“隔离内核资源”。在Linux的世界里，文件系统挂载点、主机名、POSIX进程间通信消息队列、进程PID数字空间、IP地址、user ID数字空间等全局系统资源被namespace分割，装到一个个抽象的独立空间里。而隔离上述系统资源的namespace分别是Mount namespace、UTS namespace、IPC namespace、PID namespace、network namespace和user namespace。  
> ⏱ 2024-02-21 10:40:43 ^27741281-6-644-890

> 📌 它只是移除了这个network namespace对应的挂载点（下文会解释）。只要里面还有进程运行着，network namespace便会一直存在。  
> ⏱ 2024-02-21 10:53:36 ^27741281-6-3785-3860

> 📌 clone（）总共有二十多种CLONE_*标志位用来控制clone（克隆）进程时的行为。例如，是否与父进程共享虚拟内存、打开的文件描述符、信号处理等。  
> ⏱ 2024-02-21 11:24:19 ^27741281-6-9499-9574

> 📌 大部分Linux namespace（user namespace除外）的创建都需要系统特权（capability），不一定是完整的root权限，但需要拥有CAP_SYS_ADMIN权限集来执行必要的系统调用。  
> ⏱ 2024-02-21 11:32:03 ^27741281-6-10185-10290

### 1.2 千呼万唤始出来：veth pair

> 📌 veth是虚拟以太网卡（Virtual Ethernet）的缩写。veth设备总是成对的，因此我们称之为veth pair。  
> ⏱ 2024-02-21 11:54:21 ^27741281-7-648-710

### 1.3 连接你我他：Linux bridge

> 📌 Linux bridge不会区分接入进来的到底是物理设备还是虚拟设备，对它来说没有区别。  
> ⏱ 2024-02-21 15:28:19 ^27741281-8-7410-7454

> 📌 ifconfig eth0，查看eth0的配置，包括混杂模式。当输出包含PROMISC时，表明该网络接口处于混杂模式。  
> ⏱ 2024-02-21 17:04:59 ^27741281-8-12703-12762

> 📌 将网络设备加入Linux bridge后，会自动进入混杂模式。  
> ⏱ 2024-02-21 17:05:11 ^27741281-8-13450-13481

### 1.4 给用户态一个机会：tun/tap设备

> 📌 tun/tap设备到底是什么？从Linux文件系统的角度看，它是用户可以用文件句柄操作的字符设备；从网络虚拟化角度看，它是虚拟网卡，一端连着网络协议栈，另一端连着用户态程序。  
> ⏱ 2024-02-21 17:34:21 ^27741281-9-595-682

> 📌 tun/tap设备可以将TCP/IP协议栈处理好的网络包发送给任何一个使用tun/tap驱动的进程，由进程重新处理后发到物理链路中。  
> ⏱ 2024-02-21 17:35:43 ^27741281-9-870-936

> 📌 tap设备与tun设备的工作原理完全相同，区别在于：
·tun设备的/dev/tunX文件收发的是IP包，因此只能工作在L3，无法与物理网卡做桥接，但可以通过三层交换（例如ip_forward）与物理网卡连通；
·tap设备的/dev/tapX文件收发的是链路层数据包，可以与物理网卡做桥接。  
> ⏱ 2024-02-21 17:39:44 ^27741281-9-2309-2511

### 1.5 iptables

> 📌 iptables是用户空间的一个程序，通过netlink和内核的netfilter框架打交道，负责往钩子上配置回调函数。  
> ⏱ 2024-02-21 19:05:00 ^27741281-10-2689-2749

> 📌 我们常说的iptables 5X5，即5张表（table）和5条链（chain）。5条链即iptables的5条内置链，对应上文介绍的netfilter的5个钩子。这5条链分别是：
·INPUT链：一般用于处理输入本地进程的数据包；
·OUTPUT链：一般用于处理本地进程的输出数据包；
·FORWARD链：一般用于处理转发到其他机器/network namespace的数据包；
·PREROUTING链：可以在此处进行DNAT；
·POSTROUTING链：可以在此处进行SNAT。
除了系统预定义的5条iptables链，用户还可以在表中定义自己的链，我们将通过例子详细说明。
5张表如下所示。
·filter表：用于控制到达某条链上的数据包是继续放行、直接丢弃（drop）或拒绝（reject）；
·nat表：用于修改数据包的源和目的地址；
·mangle表：用于修改数据包的IP头信息；
·raw表：iptables是有状态的，即iptables对数据包有连接追踪（connection tracking）机制，而raw是用来去除这种追踪机制的；
·security表：最不常用的表（通常，我们说iptables只有4张表，security表是新加入的特性），用于在数据包上应用SELinux。
这5张表的优先级从高到低是：raw、mangle、nat、filter、security。需要注意的是，iptables不支持用户自定义表。  
> ⏱ 2024-02-21 19:05:53 ^27741281-10-3115-4362

> 📌 iptables的规则就是挂在netfilter钩子上的函数，用来修改数据包的内容或过滤数据包，iptables的表就是所有规则的5个逻辑集合！  
> ⏱ 2024-02-22 01:12:10 ^27741281-10-5319-5391

> 📌 数据包匹配后该怎么办，常见的动作有下面几个：
·DROP：直接将数据包丢弃，不再进行后续的处理。应用场景是不让某个数据源意识到你的系统的存在，可以用来模拟宕机；
·REJECT：给客户端返回一个connection refused或destination unreachable报文。应用场景是不让某个数据源访问你的系统，善意地告诉他：我这里没有你要的服务内容；
·QUEUE：将数据包放入用户空间的队列，供用户空间的程序处理；
·RETURN：跳出当前链，该链里后续的规则不再执行；
·ACCEPT：同意数据包通过，继续执行后续的规则；
·JUMP：跳转到其他用户自定义的链继续执行。  
> ⏱ 2024-02-22 01:13:16 ^27741281-10-5657-6118

> 📌 由于自定义的链没有与netfilter里的钩子进行绑定，所以它不会自动触发，只能从其他链的规则中跳转过来，这也是JUMP动作存在的意义。  
> ⏱ 2024-02-22 01:13:34 ^27741281-10-6183-6251

> 📌 如果iptables规则前面是自定义链，则意味着这条规则的动作是JUMP，即跳到这条自定义链遍历其下的所有规则，然后跳回来遍历原来那条链后面的规则。  
> ⏱ 2024-02-23 18:06:58 ^27741281-10-7630-7704



# 读书笔记




# 本书评论

